<!DOCTYPE html>
<html lang="{{ lang | default('en') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Magic Box - Ultimate Audio Experience{% endblock %}</title>

    <!-- Main CSS -->
    <link rel="stylesheet" href="/static/css/main.css">

    <!-- htmx 1.9.12 -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- Alpine.js 3.13.10 -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.10/dist/cdn.min.js"></script>

    {% block extra_head %}{% endblock %}
</head>
<body
    x-data="{
        mobileMenuOpen: false,
        toggleMenu() {
            this.mobileMenuOpen = !this.mobileMenuOpen;
            if (this.mobileMenuOpen) {
                this.$nextTick(() => this.$refs.firstNavLink?.focus());
            }
        },
        closeMenu() {
            if (this.mobileMenuOpen) {
                this.mobileMenuOpen = false;
                this.$nextTick(() => this.$refs.mainContent?.focus());
            }
        },
    }"
    :class="{ 'menu-open': mobileMenuOpen }"
    @keydown.window.escape.prevent="closeMenu()"
>
    <!-- Mobile Menu Toggle Button -->
    <button
        class="mobile-menu-toggle"
        @click="toggleMenu()"
        :aria-expanded="mobileMenuOpen"
        aria-controls="primary-sidebar"
        aria-label="Toggle navigation menu"
        data-testid="mobile-menu-toggle"
    >
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Sidebar Navigation -->
    <aside
        id="primary-sidebar"
        class="sidebar"
        :class="{ 'open': mobileMenuOpen }"
        role="navigation"
        aria-label="Primary navigation"
    >
        {% include 'components/sidebar.html' %}
    </aside>

    <!-- Overlay for mobile menu (clicking closes menu) -->
    <div
        class="menu-overlay"
        data-testid="menu-overlay"
        @click="closeMenu()"
        x-show="mobileMenuOpen"
        x-transition.opacity
        x-cloak
    ></div>

    <!-- Main Content -->
    <main class="main-content" x-ref="mainContent" tabindex="-1">
        {% block content %}
        <!-- Page content goes here -->
        {% endblock %}
    </main>

    <!-- Global utilities -->
    <script src="/static/js/utils.js"></script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
