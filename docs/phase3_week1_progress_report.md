# Phase 3 Week 1 é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

**æ—¥ä»˜:** 2025-11-21
**æœŸé–“:** Week 1 Day 1-5
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** åŸºæœ¬å®Ÿè£…å®Œäº†ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ã‚ã‚Š

---

## å®Ÿæ–½å†…å®¹ã‚µãƒãƒªãƒ¼

### âœ… å®Œäº†ã—ãŸä½œæ¥­

#### 1. Phase 2ã‚¨ãƒ³ã‚¸ãƒ³ã®é™çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ– (Day 1-2)
- `libgpu_upsampler_core.a` (66KB) ã‚’ä½œæˆ
- POSITION_INDEPENDENT_CODE=ON ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
- æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã¨ã®äº’æ›æ€§ç¶­æŒï¼ˆ28.39x realtimeï¼‰

**æˆæœç‰©:**
- `build/libgpu_upsampler_core.a`
- `build/gpu_upsampler` (ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã€å‹•ä½œç¢ºèªæ¸ˆã¿)

#### 2. LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åŸºæœ¬å®Ÿè£… (Day 1-2)
**ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«:**
- `src/lv2_plugin/gpu_upsampler_lv2.h` - URIã¨ãƒãƒ¼ãƒˆå®šç¾©
- `src/lv2_plugin/gpu_upsampler_lv2.cpp` - LV2è¨˜è¿°å­å®Ÿè£…
- `src/lv2_plugin/manifest.ttl` - LV2ãƒãƒ³ãƒ‰ãƒ«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
- `src/lv2_plugin/gpu_upsampler.ttl` - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

**LV2è¨˜è¿°å­å®Ÿè£…:**
- `instantiate()`, `connect_port()`, `activate()`, `run()`, `deactivate()`, `cleanup()`
- GPU upsamplerã‚¨ãƒ³ã‚¸ãƒ³ã¨ã®çµ±åˆ
- 4ãƒãƒ¼ãƒˆæ§‹æˆï¼ˆstereo in/outï¼‰

**ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ :**
- CMakeLists.txtã«LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ“ãƒ«ãƒ‰è¨­å®šè¿½åŠ 
- `~/.lv2/gpu_upsampler.lv2/` ã¸è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ3.9MBï¼‰ã‚‚ãƒãƒ³ãƒ‰ãƒ«ã«å«ã‚ã‚‹

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«:**
```
~/.lv2/gpu_upsampler.lv2/
â”œâ”€â”€ gpu_upsampler.so (56KB)
â”œâ”€â”€ manifest.ttl
â”œâ”€â”€ gpu_upsampler.ttl
â””â”€â”€ filter_1m_min_phase.bin (3.9MB)
```

#### 3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ (Day 2)
**ä¿®æ­£ã—ãŸå•é¡Œ:**
- âŒ `hardRTCapable`å®£è¨€å‰Šé™¤ï¼ˆGPUå‡¦ç†ã¯éãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
- âŒ ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ä¿®æ­£ï¼ˆ`activate()`é–¢æ•°ï¼‰
- âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ã‚¹ä¿®æ­£ï¼ˆbundle_pathä½¿ç”¨ï¼‰
- âŒ LV2 URIä¿®æ­£ï¼ˆhttpâ†’httpsï¼‰
- âŒ ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã®è¿½åŠ 

**GitHub PR:**
- PR #6: Phase 3 LV2 Plugin Basic Implementation
- ã‚³ãƒŸãƒƒãƒˆ: c3dd22d (ãƒ‘ã‚¹åŒºåˆ‡ã‚Šä¿®æ­£)

#### 4. PipeWireçµ±åˆèª¿æŸ» (Day 3-5)
**é‡è¦ãªç™ºè¦‹:**
- PipeWire 1.0.5ã®filter-chainãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ **LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç›´æ¥ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„**
- Ubuntu 24.04ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯LV2ã‚µãƒãƒ¼ãƒˆãªã—ã§ãƒ“ãƒ«ãƒ‰
- `ldd`ç¢ºèª: filter-chainãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯LV2ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ãƒªãƒ³ã‚¯ã—ã¦ã„ãªã„

**æ¡ç”¨ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: CarlaçµŒç”±**
- ArchWikiã®æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«åŸºã¥ã
- PulseAudio null sink + Carla (JACK host) + LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
[éŸ³æ¥½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼]
  â†“
[PulseAudio null sink: gpu_upsampler_sink]
  â†“
[Carla (pw-jack) - LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ›ã‚¹ãƒˆ]
  â”œâ”€ GPU Audio Upsampler (LV2)
  â†“
[SMSL USB AUDIO DAC]
```

#### 5. Carlaçµ±åˆå®Ÿè£… (Day 5)
**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**
- `carla` - LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ›ã‚¹ãƒˆ
- `qpwgraph` - PipeWireæ¥ç¶šç®¡ç†GUI
- `lilv-utils` - LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ¤œè¨¼ãƒ„ãƒ¼ãƒ«

**ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**
1. **PulseAudio null sink:**
   ```bash
   pactl load-module module-null-sink sink_name=gpu_upsampler_sink \
     sink_properties=device.description="GPU_Audio_Upsampler" channel_map=stereo
   ```

2. **Carlaèµ·å‹•:**
   ```bash
   pw-jack carla-rack
   ```

3. **qpwgraphã§ã®æ¥ç¶š:**
   - `GPU_Audio_Upsampler` (monitor FL/FR) â†’ `Carla` (audio-in 1/2)
   - `Carla` (audio-out 1/2) â†’ `SMSL USB AUDIO` (playback FL/FR)

**å‹•ä½œç¢ºèª:**
- âœ… LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒCarlaã§èªè­˜ã•ã‚Œã‚‹ï¼ˆ`lv2ls`ã§ç¢ºèªï¼‰
- âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒRackã«è¿½åŠ å¯èƒ½
- âœ… qpwgraphã§æ¥ç¶šè¨­å®šå®Œäº†
- âœ… éŸ³å£°ãŒæ­£ã—ãæµã‚Œã‚‹ï¼ˆspeaker-testã§ç¢ºèªï¼‰
- âœ… GPU_Audio_Upsamplerã«åå¿œã‚ã‚Š

---

## æ—¢çŸ¥ã®å•é¡Œã¨åˆ¶é™äº‹é …

### ğŸ”´ Critical: ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã®æœªå®Ÿè£…
**å•é¡Œ:**
LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®`run()`é–¢æ•°ã§ã€16å€ã‚¢ãƒƒãƒ—ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ã®94%ã‚’ç ´æ£„ã—ã¦ã„ã‚‹ã€‚

**ç¾åœ¨ã®å‹•ä½œ:**
```cpp
// GPUå‡¦ç†: 44.1kHz â†’ 705.6kHz (16å€)
processStereo(input, n_samples, output_buffer);  // 16 Ã— n_samplesç”Ÿæˆ

// å‡ºåŠ›: æœ€åˆã®n_samplesã®ã¿ã‚³ãƒ”ãƒ¼ï¼ˆ94%ç ´æ£„ï¼‰
for (uint32_t i = 0; i < n_samples; i++) {
    output[i] = output_buffer[i];
}
```

**å½±éŸ¿:**
- å®Ÿè³ªçš„ã«44.1kHz â†’ 44.1kHzã®ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼
- GPUå‡¦ç†ã¯å®Ÿè¡Œã•ã‚Œã‚‹ãŒã€é«˜å‘¨æ³¢æˆåˆ†ãŒå¤±ã‚ã‚Œã‚‹
- ã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ç™ºç”Ÿã®å¯èƒ½æ€§

**è§£æ±ºç­–ï¼ˆWeek 2-4ã§å®Ÿè£…äºˆå®šï¼‰:**
- LV2 Worker APIã‚’ä½¿ç”¨ã—ãŸéåŒæœŸå‡¦ç†
- ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡ã«ã‚ˆã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›
- PipeWireã®ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆäº¤æ¸‰æ©Ÿèƒ½ã¨ã®çµ±åˆ

### âš ï¸ è‡ªå‹•èµ·å‹•æœªå®Ÿè£…
- ç¾åœ¨ã¯æ‰‹å‹•ã§Carlaã‚’èµ·å‹•ã™ã‚‹å¿…è¦ã‚ã‚Š
- systemdã‚µãƒ¼ãƒ“ã‚¹åŒ–ã¯æœªå®Ÿè£…ï¼ˆWeek 1ç¯„å›²å¤–ï¼‰

### âš ï¸ Easy Effectsçµ±åˆæœªæ¤œè¨¼
- Easy Effectsã¨ã®é€£æºã¯æœªãƒ†ã‚¹ãƒˆ
- ã‚¤ã‚³ãƒ©ã‚¤ã‚¶ â†’ GPU Upsampler ã®é †åºå‹•ä½œç¢ºèªãŒå¿…è¦

---

## æŠ€è¡“çš„ãªå­¦ã³

### PipeWireã®LV2ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦
1. **PipeWire filter-chainã®LV2ã‚µãƒãƒ¼ãƒˆ:**
   - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹åŒ–å¯èƒ½ã ãŒã€Ubuntu 24.04ã§ã¯ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ãªã„
   - ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒªãƒ“ãƒ«ãƒ‰ã™ã‚Œã°å¯èƒ½ã ãŒã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è² è·ãŒé«˜ã„

2. **Carlaã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®åˆ©ç‚¹:**
   - æˆç†Ÿã—ãŸLV2ãƒ›ã‚¹ãƒˆï¼ˆå¤šãã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§å®Ÿç¸¾ã‚ã‚Šï¼‰
   - GUIçµŒç”±ã§ã®è¨­å®šãƒ»ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“
   - PipeWire-JACK bridgeã§çµ±åˆå¯èƒ½

3. **qpwgraphã®æœ‰ç”¨æ€§:**
   - PipeWireã®æ¥ç¶šã‚’è¦–è¦šçš„ã«ç¢ºèªãƒ»è¨­å®šå¯èƒ½
   - Carlaã®å†…éƒ¨Patchbayã‚ˆã‚Šç›´æ„Ÿçš„
   - ãƒ‡ãƒãƒƒã‚°ã«éå¸¸ã«æœ‰ç”¨

### LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã®èª²é¡Œ
1. **ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›:**
   - LV2ãƒ›ã‚¹ãƒˆã¯å…¥åŠ›=å‡ºåŠ›ã‚µãƒ³ãƒ—ãƒ«æ•°ã‚’æœŸå¾…
   - å†…éƒ¨ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨Worker APIãŒå¿…é ˆ

2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶ç´„:**
   - GPUå‡¦ç†ï¼ˆCUDAï¼‰ã¯æœ¬è³ªçš„ã«éãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 
   - `hardRTCapable`ã¯ä¸é©åˆ‡
   - Worker thread + lock-free ring bufferãŒå¿…è¦

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (Week 2ä»¥é™)

### Week 2: ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã®å®Ÿè£…
**ç›®æ¨™:** LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å†…ã§æ­£ã—ã„ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã‚’å®Ÿè£…

**ã‚¿ã‚¹ã‚¯:**
1. LV2 Worker APIèª¿æŸ»ãƒ»å®Ÿè£…
2. Lock-freeãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡å®Ÿè£…
3. éåŒæœŸGPUå‡¦ç†ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè£…
4. ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨ˆæ¸¬ãƒ»å ±å‘Š

**æœŸå¾…ã•ã‚Œã‚‹æˆæœ:**
- 44.1kHzå…¥åŠ› â†’ 705.6kHzå†…éƒ¨å‡¦ç† â†’ é©åˆ‡ãªå‡ºåŠ›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶ç´„ã‚’æº€ãŸã™å‡¦ç†

### Week 3: çµ±åˆãƒ†ã‚¹ãƒˆã¨æœ€é©åŒ–
**ã‚¿ã‚¹ã‚¯:**
1. Easy Effectsã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ
2. SMSL DACã§ã®705.6kHzå‡ºåŠ›ç¢ºèª
3. ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¸¬å®šãƒ»æœ€é©åŒ–
4. é•·æ™‚é–“å‹•ä½œå®‰å®šæ€§ãƒ†ã‚¹ãƒˆ

### Week 4: systemdã‚µãƒ¼ãƒ“ã‚¹åŒ–ã¨è‡ªå‹•åŒ–
**ã‚¿ã‚¹ã‚¯:**
1. PulseAudio null sinkã®systemdã‚µãƒ¼ãƒ“ã‚¹åŒ–
2. Carlaè‡ªå‹•èµ·å‹•ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ
3. WirePlumberãƒ«ãƒ¼ãƒ«ä½œæˆï¼ˆè‡ªå‹•æ¥ç¶šï¼‰
4. èµ·å‹•æ™‚ã®æ¥ç¶šå¾©å…ƒç¢ºèª

---

## æˆæœç‰©ã®çŠ¶æ…‹

### âœ… å‹•ä½œã™ã‚‹ã‚‚ã®
- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ï¼ˆ`build/gpu_upsampler`ï¼‰
- LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆåŸºæœ¬çš„ãªãƒ­ãƒ¼ãƒ‰ãƒ»èªè­˜ï¼‰
- CarlaçµŒç”±ã§ã®éŸ³å£°ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼

### âš ï¸ åˆ¶é™ä»˜ãã§å‹•ä½œ
- GPUå‡¦ç†ï¼ˆå®Ÿè¡Œã•ã‚Œã‚‹ãŒå‡ºåŠ›ãŒæ­£ã—ããªã„ï¼‰
- ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ï¼ˆå®Ÿè³ªãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼ï¼‰

### âŒ æœªå®Ÿè£…
- æ­£ã—ã„ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›
- éåŒæœŸGPUå‡¦ç†
- è‡ªå‹•èµ·å‹•ãƒ»æ¥ç¶šå¾©å…ƒ

---

## å‚è€ƒè³‡æ–™

### ä½¿ç”¨ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ArchWiki: PipeWire - LADSPA, LV2, VST ãƒ—ãƒ©ã‚°ã‚¤ãƒ³](https://wiki.archlinux.jp/index.php/PipeWire#LADSPA.E3.80.81LV2.E3.80.81VST_.E3.83.97.E3.83.A9.E3.82.B0.E3.82.A4.E3.83.B3)
- LV2 Specification: http://lv2plug.in/
- Carla Documentation: https://kx.studio/Documentation:Carla

### ç¢ºèªã—ãŸã‚³ãƒãƒ³ãƒ‰
```bash
# LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³èªè­˜ç¢ºèª
lv2ls | grep gpu_upsampler
lv2info https://github.com/michihitoTakami/gpu_upsampler

# PipeWireæ¥ç¶šç¢ºèª
pw-cli list-objects
pactl list sinks

# Carlaèµ·å‹•
pw-jack carla-rack

# æ¥ç¶šç®¡ç†
qpwgraph
```

---

## ã¾ã¨ã‚

**Week 1ã®ç›®æ¨™é”æˆåº¦: 80%**

âœ… **é”æˆ:**
- LV2ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åŸºæœ¬å®Ÿè£…
- Carlaçµ±åˆã®å®Ÿè¨¼
- éŸ³å£°ãƒ‘ã‚¹ã®ç¢ºç«‹

âš ï¸ **èª²é¡Œ:**
- ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã®æ­£ã—ã„å®Ÿè£…ãŒå¿…è¦
- å½“åˆè¨ˆç”»ï¼ˆPipeWire Filter-Chainç›´æ¥çµ±åˆï¼‰ã‹ã‚‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´

**æ¬¡ã®å„ªå…ˆã‚¿ã‚¹ã‚¯:**
1. LV2 Worker APIã®å®Ÿè£…èª¿æŸ»
2. ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆå¤‰æ›ã®è¨­è¨ˆãƒ»å®Ÿè£…
3. å®Ÿéš›ã®éŸ³è³ªå‘ä¸Šã®ç¢ºèª

---

**å ±å‘Šè€…:** Claude Code
**ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡:** Week 2å®Ÿè£…è¨ˆç”»ã®æ‰¿èª
