# 品質テストチェックリスト

## 概要

Magic Box製品出荷前の品質検証チェックリストです。すべての項目をパスすることが出荷条件となります。

---

## 1. ハードウェア検証

### 1.1 物理検査

- [ ] 外観に傷・汚れがないこと
- [ ] USBポート（Type-C入力、Type-A出力）に異常がないこと
- [ ] 電源LEDが正常に点灯すること
- [ ] 異常な発熱がないこと（50°C以下）

### 1.2 接続検査

- [ ] USB Type-CでPCと接続できること
- [ ] USB Type-Aで外部DACを認識すること
- [ ] 電源投入後30秒以内にReady状態になること

---

## 2. USB Gadget検証

### 2.1 デバイス認識

| OS | 確認項目 | 合否 |
|----|---------|------|
| Windows 10/11 | USBオーディオデバイスとして認識 | [ ] |
| macOS | USBオーディオデバイスとして認識 | [ ] |
| Linux | `aplay -l`でデバイス表示 | [ ] |

### 2.2 USB Ethernet

| OS | 確認項目 | 合否 |
|----|---------|------|
| Windows 10/11 | ネットワークアダプタとして認識 | [ ] |
| macOS | ネットワーク設定に表示 | [ ] |
| Linux | `ip addr`でusb0表示 | [ ] |

### 2.3 DHCP/IP

- [ ] PC側でIPアドレス自動取得（192.168.55.100付近）
- [ ] Jetson側固定IP（192.168.55.1）疎通確認
- [ ] `ping 192.168.55.1` 応答あり

---

## 3. Web UI検証

### 3.1 アクセス

- [ ] `http://192.168.55.1/` でWeb UIが表示される
- [ ] `http://magicbox.local/` でWeb UIが表示される（mDNS対応環境）
- [ ] ページロード時間 < 3秒

### 3.2 機能

- [ ] ステータス表示が更新される
- [ ] ヘッドホン選択UIが動作する
- [ ] EQプロファイル適用が動作する
- [ ] デーモン再起動ボタンが動作する

### 3.3 レスポンシブ

- [ ] PC（1920x1080）で正常表示
- [ ] タブレット（iPad）で正常表示
- [ ] スマートフォン（iPhone）で正常表示

---

## 4. オーディオ処理検証

### 4.1 入力認識

| 入力レート | 確認項目 | 合否 |
|-----------|---------|------|
| 44.1kHz | 正常に認識、処理開始 | [ ] |
| 48kHz | 正常に認識、処理開始 | [ ] |
| 96kHz | 正常に認識、処理開始 | [ ] |

### 4.2 出力動作

| 出力レート | DAC | 確認項目 | 合否 |
|-----------|-----|---------|------|
| 705.6kHz | (指定DAC) | 音声出力正常 | [ ] |
| 768kHz | (指定DAC) | 音声出力正常 | [ ] |

### 4.3 音質検査

- [ ] ノイズなし（無音時に-90dB以下）
- [ ] クリック・ポップノイズなし
- [ ] 左右チャンネル正常
- [ ] 音量レベル適正（クリッピングなし）

### 4.4 長時間安定性

| テスト | 条件 | 合否 |
|--------|------|------|
| 10分連続再生 | XRUN 0回 | [ ] |
| 1時間連続再生 | XRUN 0回 | [ ] |
| レート切替テスト | 44.1k⇔48k 10回 | [ ] |

### 4.5 低遅延パーティション検証

- [ ] `partitionedConvolution.enabled = true`、`fastPartitionTaps` / `tailFftMultiple` が仕様通りに反映されている
- [ ] `pw-loopback` または ALSA loopback で `test_impulse_44100hz.wav` を通し、`scripts/analysis/inspect_impulse.py` の energy 比率が >99%（fast）になる
- [ ] `scripts/analysis/verify_frequency_response.py --compare-fast-tail` で fast/tail スペクトル差分 < 0.5 dB
- [ ] `nvidia-smi dmon` で GPU Utilization < 20% を維持
- [ ] `/proc/asound/*/status` の `XRUNs` が 0 のまま 10 分以上継続
- [ ] 実施手順・ログを `docs/investigations/low_latency_partition_validation.md` に記録

---

## 5. EQ/ヘッドホン補正検証

### 5.1 EQ適用

- [ ] EQプロファイル読み込み正常
- [ ] EQ適用で音質変化が確認できる
- [ ] EQ無効化で元の音に戻る

### 5.2 ヘッドホン選択

- [ ] OPRAデータベースからヘッドホン一覧取得
- [ ] ヘッドホン選択でEQ自動生成
- [ ] 適用後に音質変化確認

---

## 6. 信頼性検証

### 6.1 起動・停止

| テスト | 回数 | 合否 |
|--------|------|------|
| 電源ON/OFF | 10回 | [ ] |
| サービス再起動 | 10回 | [ ] |
| USB抜き差し | 10回 | [ ] |

### 6.2 エラー回復

- [ ] DAC抜去時にエラー表示、再接続で復帰
- [ ] 入力停止時にミュート、再開で自動復帰
- [ ] Watchdogによる自動再起動

### 6.3 メモリリーク

- [ ] 24時間動作後のメモリ使用量が起動時と同等（±10%）

---

## 7. セキュリティ検証

### 7.1 ネットワーク

- [ ] USB Ethernet以外からのアクセス不可
- [ ] 不要ポートが閉じている（nmap確認）
- [ ] SSH無効（製品版）

### 7.2 ファイルシステム

- [ ] 重要ファイルのパーミッション適正
- [ ] 不要なデバッグファイルなし

---

## 8. ドキュメント・パッケージング

### 8.1 同梱物

- [ ] クイックスタートガイド
- [ ] 保証書
- [ ] USBケーブル（Type-C to Type-A）

### 8.2 ファームウェア

- [ ] 最新バージョンがインストールされている
- [ ] OTAアップデート機能の動作確認

---

## テスト結果記録

| 項目 | 結果 | テスト日 | テスター |
|------|------|---------|---------|
| シリアル番号 | | | |
| ファームウェアVer | | | |
| 総合判定 | PASS / FAIL | | |
| 備考 | | | |

---

## 判定基準

### PASS条件

- すべてのチェック項目がパス
- 重大な不具合なし

### 再検査

- 軽微な不具合があり修正後再テスト

### FAIL

- 重大な不具合あり
- 修理または廃棄

---

## 関連ドキュメント

- [performance-benchmark.md](./performance-benchmark.md) - 性能ベンチマーク
- [../troubleshooting.md](../troubleshooting.md) - トラブルシューティング
- [../deployment/factory-provisioning.md](../deployment/factory-provisioning.md) - 工場プロビジョニング
